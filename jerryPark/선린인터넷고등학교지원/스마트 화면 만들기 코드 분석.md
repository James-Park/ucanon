# 스마트 화면 만들기 코드 분석



```c
/*
   <<<<<아두이노 개인 프로젝트 발표>>>>>

   프로그램명 : 스마트 화분 만들기
   프로그램 작성자 : 변경희
   작성년월일 : 2018. 07. 28. 토요일
   사용센서 : 토양수분감지 센서, DotMatrix, LCD, 온습도센서
   식물의 성질에 따라, 온도와 습도, 토양의 수분함량 등을 감지하여
   사용자에게 화분의 상태를 알려주는 스마트 화분
*/
```

* 위 코드는 프로그램에 전체적인 설명을 담은 주석입니다.
* 주석을 통해서 우리는 코드 리뷰를 통해서 이해하기 힘든 코드에 대한 설명을 담깁니다.
* 주석은 실제 프로그램이 동작하는데는 영향을 미치지 않습니다.
* 주석은 나와 다른 사람이 나중에 다시 코드를 보게 되었을 때 이해를 돕기 위해서 작성한 설명입니다.
* 내 자신도 지금 당장은 이 코드가 바로 이해가 되겠지만, 몇 달, 몇 년이 지나서 자신의 코드를 보면 내가 왜 이렇게 코드를 작성했는지 이해가 안될 때가 많습니다. 
* 주석은 코드를 리뷰하게 되는 사람에 대한 배려의 마음으로 작성해야 합니다.
* 제일 좋은 코드는 주석이 없어도 바로 직관적으로 이해가 되는 코드입니다.



```c
#include <Wire.h>
```

* include라는 예약어는 현재 소스 코드 파일 안에 작성되어 있지 않은, 다른 코드나 라이브러리를 불러들이기 위한 명령어입니다.

* 다우이노로 TWI( 또는 I2C) 통신을 하기 위해서 Wire 라는 라이브러리를 include해서 사용해야 한다.

* 시리얼 통신이 1:1 통신 규약인 반면, TWI는 1:n 통신 규약으로서 하나의 마스터(master) 기기가 여러 개의 슬레이브(slave) 디바이스들과 통신을 할 수 있다는 장점이 있다. Wire라이브러리는 아두이노의 표준 라이브러리이므로 아두이노 IDE에 기본으로 내장되어 있다.

* [관련 사이트]:(https://studymake.tistory.com/231)

  

```c
#include <Adafruit_Sensor.h>
```

* 온습도 센스(DHT11, DHT22) 디바이스를 제어하기 위한 라이브러리를 Include한다.

* [관련 사이트]:(https://m.blog.naver.com/PostView.nhn?blogId=chandong83&amp;logNo=220875868466)
  

```c
#include "LedControl.h"
```

*  DotMatrix는 LED를 8x8개 격자형으로 구성해 놓은 디스플레이 장치다.



```c
#define DHTTYPE DHT11
```



```c
int SOILPIN = A0;
int DHTPIN = 5;
int val = 0;
int data = 0;
```


```c
// happy face
byte hf[8] = {B00111100, B01000010, B10100101, B10000001, B10100101, B10011001, B01000010, B00111100}; 

// neutral face
byte nf[8] = {B00111100, B01000010, B10100101, B10000001, B10111101, B10000001, B01000010, B00111100};
// sad face
byte sf[8] = {B00111100, B01000010, B10100101, B10000001, B10011001, B10100101, B01000010, B00111100};
```

* byte는 바이트형 변수를 선언하기 위한 선언자입니다.

* byte는 

* 관련 사이트
  * [C언어 기본 자료형의 크기와 범위](https://newmkka.tistory.com/69)

```c
LedControl lc = LedControl(12, 10, 11, 2); // Pins: DIN,CLK,CS, # of Display connected
DHT dht(DHTPIN, DHTTYPE);
```



```c
void setup ()
{
  pinMode (SOILPIN, INPUT);
  pinMode (DHTPIN, INPUT);
  Serial.begin (9600);
  dht.begin();

  lc.shutdown(0, false); // Wake up displays
  lc.shutdown(1, false);
  lc.setIntensity(0, 5); // Set intensity levels
  lc.setIntensity(1, 5);
  lc.clearDisplay(0);  // Clear Displays
  lc.clearDisplay(1);
}
```



```c
void loop ()
{
  val = analogRead (SOILPIN);
  //val = map(val, 1023, 0, 0, 100);
  float temp = dht.readTemperature();

  Serial.print("Mositure : ");
  Serial.println(val);

  Serial.print("Temperature : ");
  Serial.print(temp);
  Serial.println("*C");

  //  Serial.println("%");
  if (val <= 300) {
    if (temp >= 18 && temp <= 30) {
      Serial.println("I am happy!!!");
      Serial.println("Temperature was comfortable~:)");
      Serial.println("I am happy!!!");
      drHappy (); // Display happy face
    } else if (temp < 18) {
      Serial.println("I am too Cold TT");
      Serial.println("Turn up the heat!!!");
      drSad ();
    } else if (temp > 30) {
      Serial.println("I am too Hot TT");
      Serial.println("Turn down the heat!!!");
      drSad ();
    }
  } else if (val <= 550 && val > 300) {
    Serial.println("So So...");
    if (temp >= 18 && temp <= 30) {
      Serial.println("Temperature was comfortable~:)");
      Serial.println("So So...");
      drNeutral ();
    } else if (temp < 18) {
      Serial.println("I am too Cold TT");
      Serial.println("Turn up the heat!!!");
      drSad ();
    } else if (temp > 30) {
      Serial.println("I am too Hot TT");
      Serial.println("Turn down the heat!!!");
      drSad ();
    }
  } else if (val > 550) {
    Serial.println("Give me a Water!!!");
    if (temp >= 18 && temp <= 30) {
      Serial.println("Temperature was comfortable~:)");
      Serial.print("Give me Water!!!");
      drSad ();
    } else if (temp < 18) {
      Serial.println("I am thirsty & too Cold~~~TT");
      Serial.println("Give me water & Turn up the heat!!!");
      drSad ();
    } else if (temp > 30) {
      Serial.println("I am thirsty & too Hot~~~TT");
      Serial.println("Give me water & Turn down the heat!!!");
      drSad ();
    }
  }
  delay (3000);
}
```



```c
void drHappy () {
  lc.setRow(0, 0, hf[0]);
  lc.setRow(0, 1, hf[1]);
  lc.setRow(0, 2, hf[2]);
  lc.setRow(0, 3, hf[3]);
  lc.setRow(0, 4, hf[4]);
  lc.setRow(0, 5, hf[5]);
  lc.setRow(0, 6, hf[6]);
  lc.setRow(0, 7, hf[7]);
}
```



```c
void drSad () {
  lc.setRow(0, 0, sf[0]);
  lc.setRow(0, 1, sf[1]);
  lc.setRow(0, 2, sf[2]);
  lc.setRow(0, 3, sf[3]);
  lc.setRow(0, 4, sf[4]);
  lc.setRow(0, 5, sf[5]);
  lc.setRow(0, 6, sf[6]);
  lc.setRow(0, 7, sf[7]);
}
```



```c
void drNeutral () {
  lc.setRow(0, 0, nf[0]);
  lc.setRow(0, 1, nf[1]);
  lc.setRow(0, 2, nf[2]);
  lc.setRow(0, 3, nf[3]);
  lc.setRow(0, 4, nf[4]);
  lc.setRow(0, 5, nf[5]);
  lc.setRow(0, 6, nf[6]);
  lc.setRow(0, 7, nf[7]);
}
```